<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Lab Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 h-screen flex items-center justify-center">

    <div class="glass-card p-8 rounded-2xl shadow-2xl w-96 text-center">
        
        <div class="text-4xl mb-4">üîê</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">RESET PASSWORD</h2>
        <p class="text-gray-500 text-xs mb-6">Masukkan kode dari email & password barumu.</p>

        <form onsubmit="handleResetProcess(event)">
            <div class="mb-3 text-left">
                <label class="block text-xs font-bold text-gray-600 mb-1">EMAIL KAMU</label>
                <input type="email" id="email" required class="w-full p-2 border rounded bg-gray-100" placeholder="email@kamu.com">
            </div>

            <div class="mb-3 text-left">
                <label class="block text-xs font-bold text-gray-600 mb-1">KODE RESET (6 DIGIT)</label>
                <input type="text" id="token" required class="w-full p-2 border rounded font-mono text-center tracking-widest text-lg" placeholder="123456" maxlength="6">
            </div>

            <div class="mb-4 text-left">
                <label class="block text-xs font-bold text-gray-600 mb-1">PASSWORD BARU</label>
                <input type="password" id="newPass" required class="w-full p-2 border rounded" placeholder="******">
            </div>

            <button type="submit" class="w-full bg-indigo-600 text-white p-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg">
                UBAH PASSWORD SEKARANG
            </button>
        </form>

        <div class="mt-4 text-xs">
            <a href="test_admin.html" class="text-gray-500 hover:text-indigo-600">Batal</a>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost/inlet-project/public/index.php?url=auth/verify_reset';

        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('email')) {
            document.getElementById('email').value = urlParams.get('email');
        }

        function handleResetProcess(e) {
            e.preventDefault();
            
            const data = {
                email: document.getElementById('email').value,
                token: document.getElementById('token').value,
                new_password: document.getElementById('newPass').value
            };

            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(d => {
                if(d.status === 'success') {
                    alert("‚úÖ BERHASIL! Password sudah diganti.\nSilakan login dengan password baru.");
                    window.location.href = 'test_admin.html'; // Balik ke login
                } else {
                    alert("‚ùå GAGAL: " + d.message);
                }
            })
            .catch(err => alert("Error Koneksi: " + err));
        }
    </script>
</body>
</html>